# OTU_prediction_ML

Scripts for collating data, pre-processing steps, ML model and model evaluation.

## 1. Input data format
`ML_data_formatting.py` takes two input files per sample:

-  `sample_abundance.txt` A two column tab-delimited file containing NCBI accession number (i.e. `NZ_CP030982.1`) and abundance. Each file must be named in the manner shown here, where 'sample' can be replaced with specific identifier.
-  `sample_centrifugeReport.txt` A standard [centrifuge](https://ccb.jhu.edu/software/centrifuge/) output. Each file must be named in the manner shown here, where 'sample' can be replaced with specific identifier.

These files must be in a directory named with the sample identifier (consistent across both files and directory). 
The script takes two user input values:

1. The path to the directory which contains your sample directories.
2. The path to the directory you would like the processed outputs storing.

The processed outputs contain the following data, and are in comma-separated 'txt' files, named: `sample_data.txt`

The data has the following columns:

- **name:** OTU name; generated by centrifuge. Not used in model as non-numeric.
- **taxID:** 1-7 digit number. Unique OTU identifier, used to match centrifuge hits and actual presence.
- **taxRank:** 'Sprecies', 'genus', 'family' etc...
- **genomeSize:** Size of OTU genome. Only meaningful for OTU classification at 'species' or above.
- **numReads:** Total number of reads mapping to OTU.
- **numUniqueReads:** Unique only reads mapping to OTU.
- **abundance:** Number of reads/total reads.
- **genus:** A grouping variable, included only where it can be determined (i.e. classification at 'genus' level and above).
- **presence:** Binary variable, 0 = not present; 1 = present. Determined from original `abundance.txt` files. Used to train and validate predictions.
- **sim_abundance:** 'Real' abundance of reads in each sample. Used to train and validate mode predictions.

**Note:** Script uses biopython to query NCBI to match taxIDs. You will likely need to give your Entrez details (minimum: email).

## 2. Run the ML model
`ML_RandomForest_OTU_prediction.py` Requires the data generated in step 1, and data must be split into `training` and `test` directories (specified in the script). The model will use the numeric only variables (i.e. `name`, `genus` and `taxRank` are dropped). Per `test` sample performance metrics are provided, along with `overall` metrics. A `Confusion Matrix` is also produced (printed to screen).

## 3. Check important features
`ML_features.py` Determines which of the data features (based on the `training` data set) is driving the model. Requires the location of the directory housing the training data set only, and produces a `bar chart`.
